<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Aplicación de Validación – Semana 5</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Fondo tipo neón/circuito */
    body::before{
      content:"";
      position:fixed; inset:0;
      background-image:url("https://images.unsplash.com/photo-1557683316-973673baf926?q=80&w=1920&auto=format&fit=crop");
      background-size:cover; background-position:center;
      filter:saturate(1.2) brightness(0.65) blur(2px);
      z-index:-2;
    }
    body::after{
      content:"";
      position:fixed; inset:0;
      background:
        radial-gradient(60% 60% at 20% 10%, rgba(135,206,250,0.20), transparent 60%),
        radial-gradient(50% 50% at 80% 80%, rgba(186,85,211,0.20), transparent 60%);
      z-index:-1; pointer-events:none;
    }
    .card { background: rgba(255,255,255,0.9); }
    .glass { background: rgba(255,255,255,0.08); backdrop-filter: blur(8px); border:1px solid rgba(255,255,255,.25); }
  </style>
</head>
<body class="min-h-screen w-full text-gray-50">
  <main class="max-w-5xl mx-auto p-6 md:p-10">
    <header class="mb-6">
      <h1 class="text-3xl md:text-4xl font-extrabold tracking-tight drop-shadow">Aplicación de Validación – Semana 5</h1>
      <p class="text-white/90 mt-2">Practique pruebas <span class="font-semibold">caja negra</span>, <span class="font-semibold">caja blanca</span> y <span class="font-semibold">regresión</span>.</p>
    </header>

    <nav class="flex items-center gap-3 mb-6">
      <button id="btnForm" class="px-4 py-2 rounded-xl font-medium bg-white/90 text-gray-900 shadow">Formulario</button>
      <button id="btnList" class="px-4 py-2 rounded-xl font-medium bg-white/20 text-white hover:bg-white/30">Registros</button>
      <div class="ml-auto text-sm text-white/80">Total: <span id="totalCount" class="font-semibold">0</span></div>
    </nav>

    <section class="grid md:grid-cols-2 gap-8">
      <!-- Columna principal -->
      <div id="panelForm">
        <div class="grid md:grid-cols-3 gap-4 mb-6">
          <div class="card rounded-2xl shadow p-4">
            <div class="font-semibold text-gray-900">Estado de Texto</div>
            <div class="text-xs text-gray-600">Alfabético, 6–10 caracteres</div>
            <div id="stateText" class="mt-2 text-sm font-medium"></div>
          </div>
          <div class="card rounded-2xl shadow p-4">
            <div class="font-semibold text-gray-900">Estado de Fecha</div>
            <div class="text-xs text-gray-600">Hoy o anterior</div>
            <div id="stateDate" class="mt-2 text-sm font-medium"></div>
          </div>
          <div class="card rounded-2xl shadow p-4">
            <div class="font-semibold text-gray-900">Estado de Número</div>
            <div class="text-xs text-gray-600">0–10</div>
            <div id="stateQty" class="mt-2 text-sm font-medium"></div>
          </div>
        </div>

        <form id="form" class="card text-gray-900 rounded-2xl shadow p-6 space-y-5">
          <div>
            <label class="block text-sm font-medium mb-1">Texto alfabético (6–10)</label>
            <input id="text" class="w-full px-4 py-3 rounded-2xl outline-none border shadow-sm border-emerald-300 focus:border-emerald-500" placeholder="Ej: Marisol" />
            <p id="helpText" class="mt-1 text-sm"></p>
          </div>

        <div>
            <label class="block text-sm font-medium mb-1">Fecha (no futura)</label>
            <input id="date" type="date" class="w-full px-4 py-3 rounded-2xl outline-none border shadow-sm border-emerald-300 focus:border-emerald-500" />
            <p id="helpDate" class="mt-1 text-sm"></p>
          </div>

          <div>
            <label class="block text-sm font-medium mb-1">Número (0–10)</label>
            <input id="qty" inputmode="numeric" class="w-full px-4 py-3 rounded-2xl outline-none border shadow-sm border-emerald-300 focus:border-emerald-500" placeholder="Ej: 5" />
            <p id="helpQty" class="mt-1 text-sm"></p>
          </div>

          <div class="flex items-center gap-3 pt-2">
            <button id="submit" type="submit" class="px-5 py-3 rounded-2xl font-medium shadow bg-emerald-500 text-white hover:bg-emerald-600">Validar y Enviar</button>
            <span id="badge" class="px-3 py-1 rounded-xl text-sm font-medium hidden"></span>
          </div>
        </form>
      </div>

      <!-- Columna secundaria -->
      <div id="panelList" class="glass rounded-2xl p-6 overflow-y-auto max-h-[80vh] hidden">
        <div class="flex items-center mb-4">
          <h2 class="text-xl font-semibold">Registros almacenados</h2>
          <button id="clear" class="ml-auto text-xs px-3 py-1 rounded-lg bg-rose-500/80 hover:bg-rose-600 text-white hidden">Borrar todo</button>
        </div>
        <div id="listEmpty" class="text-white/80">No hay registros aún. Vuelva al formulario para crear uno.</div>
        <div id="listWrap" class="hidden overflow-x-auto">
          <table class="min-w-full text-sm text-left">
            <thead class="text-gray-900">
              <tr class="bg-white/80">
                <th class="px-3 py-2 rounded-l-lg">#</th>
                <th class="px-3 py-2">Texto</th>
                <th class="px-3 py-2">Fecha</th>
                <th class="px-3 py-2">Número</th>
                <th class="px-3 py-2 rounded-r-lg">Creado</th>
              </tr>
            </thead>
            <tbody id="tbody"></tbody>
          </table>
        </div>
      </div>
    </section>

    <footer class="text-xs text-white/70 mt-10">Versión demo para PRO402 – Taller de Testing y Calidad de Software · Semana 5</footer>
  </main>

  <script>
    /* ------- estado y helpers ------- */
    const $ = (sel) => document.querySelector(sel);
    const todayISO = new Date().toISOString().slice(0,10);
    $("#date").max = todayISO;

    const LS_KEY = "pro402_records_vanilla";
    const load = () => JSON.parse(localStorage.getItem(LS_KEY) || "[]");
    const save = (arr) => localStorage.setItem(LS_KEY, JSON.stringify(arr));

    function setHelp(el, ok, okMsg, errMsg){
      el.textContent = ok ? okMsg : errMsg;
      el.className = "mt-1 text-sm " + (ok ? "text-emerald-600" : "text-rose-600");
    }
    function setState(el, ok){
      el.textContent = ok ? "✔ OK" : "✖ Error";
      el.className = ok ? "text-emerald-200 font-semibold" : "text-rose-200 font-semibold";
    }

    /* ------- validaciones ------- */
    function validateText(v){
      const isAlpha = /^[A-Za-zÁÉÍÓÚÜÑáéíóúüñ]+$/.test(v || "");
      return ({ ok: isAlpha && v.length>=6 && v.length<=10, isAlpha, len: v.length });
    }
    function validateDate(v){
      if(!v) return { ok:false, msg:"Requerido" };
      const d = new Date(v+"T00:00:00");
      const t = new Date(todayISO+"T00:00:00");
      return { ok: d.getTime() <= t.getTime() };
    }
    function validateQty(v){
      if(v==="") return { ok:false, msg:"Requerido" };
      const n = Number(v);
      return { ok: Number.isFinite(n) && n>=0 && n<=10, n };
    }

    /* ------- UI: tabs ------- */
    const btnForm = $("#btnForm"), btnList = $("#btnList");
    const panelForm = $("#panelForm"), panelList = $("#panelList");
    function showForm(){ panelForm.classList.remove("hidden"); panelList.classList.add("hidden");
      btnForm.className="px-4 py-2 rounded-xl font-medium bg-white/90 text-gray-900 shadow";
      btnList.className="px-4 py-2 rounded-xl font-medium bg-white/20 text-white hover:bg-white/30";
    }
    function showList(){ panelForm.classList.add("hidden"); panelList.classList.remove("hidden");
      btnList.className="px-4 py-2 rounded-xl font-medium bg-white/90 text-gray-900 shadow";
      btnForm.className="px-4 py-2 rounded-xl font-medium bg-white/20 text-white hover:bg-white/30";
      renderList();
    }
    btnForm.onclick = showForm;
    btnList.onclick = showList;

    /* ------- form ------- */
    const inputText = $("#text"), inputDate = $("#date"), inputQty = $("#qty");
    const helpText = $("#helpText"), helpDate = $("#helpDate"), helpQty = $("#helpQty");
    const stateText = $("#stateText"), stateDate = $("#stateDate"), stateQty = $("#stateQty");
    const badge = $("#badge"), submit = $("#submit");
    let submitted = false;

    function revalidate(){
      const vt = validateText(inputText.value);
      const vd = validateDate(inputDate.value);
      const vq = validateQty(inputQty.value);

      setHelp(helpText, vt.ok, "Formato correcto", inputText.value ? (vt.isAlpha ? `Largo actual: ${vt.len}. Debe ser 6–10` : "Solo letras (sin espacios ni números)") : "Requerido");
      setHelp(helpDate, vd.ok, "Fecha válida", inputDate.value ? "La fecha no puede ser futura" : "Requerido");
      setHelp(helpQty, vq.ok, "En rango", inputQty.value!=="" ? "Debe ser número entre 0 y 10" : "Requerido");

      setState(stateText, vt.ok);
      setState(stateDate, vd.ok);
      setState(stateQty, vq.ok);

      submit.disabled = !(vt.ok && vd.ok && vq.ok);
      submit.className = "px-5 py-3 rounded-2xl font-medium shadow " + (submit.disabled ? "bg-white/40 text-white/80 cursor-not-allowed" : "bg-emerald-500 text-white hover:bg-emerald-600");
      return { vt, vd, vq };
    }
    inputText.oninput = revalidate;
    inputDate.oninput = revalidate;
    inputQty.oninput = (e)=>{ e.target.value = e.target.value.replace(/[^0-9.-]/g,""); revalidate(); };
    revalidate();

    $("#form").onsubmit = (e)=>{
      e.preventDefault();
      submitted = true;
      const { vt, vd, vq } = revalidate();
      if(vt.ok && vd.ok && vq.ok){
        const records = load();
        records.unshift({
          id: Date.now(),
          text: inputText.value,
          date: inputDate.value,
          qty: Number(inputQty.value),
          createdAt: new Date().toISOString()
        });
        save(records);
        inputText.value=""; inputDate.value=""; inputQty.value="";
        revalidate();
        badge.textContent = "Datos enviados (simulado)";
        badge.className = "px-3 py-1 rounded-xl text-sm font-medium bg-emerald-100 text-emerald-800";
        showList();
      } else {
        badge.textContent = "Revise los campos";
        badge.className = "px-3 py-1 rounded-xl text-sm font-medium bg-rose-100 text-rose-800";
      }
      setTimeout(()=>{ badge.classList.add("hidden"); }, 1800);
      badge.classList.remove("hidden");
    };

    /* ------- lista ------- */
    const totalCount = $("#totalCount");
    const listEmpty = $("#listEmpty");
    const listWrap = $("#listWrap");
    const tbody = $("#tbody");
    const clearBtn = $("#clear");

    function renderList(){
      const data = load();
      totalCount.textContent = data.length;
      clearBtn.classList.toggle("hidden", data.length===0);
      listEmpty.classList.toggle("hidden", data.length>0);
      listWrap.classList.toggle("hidden", data.length===0);
      tbody.innerHTML = data.map((r, i)=>`
        <tr class="${i%2? 'bg-white/10':'bg-white/5'}">
          <td class="px-3 py-2">${data.length - i}</td>
          <td class="px-3 py-2">${r.text}</td>
          <td class="px-3 py-2">${r.date}</td>
          <td class="px-3 py-2">${r.qty}</td>
          <td class="px-3 py-2">${new Date(r.createdAt).toLocaleString()}</td>
        </tr>
      `).join("");
    }
    clearBtn.onclick = ()=>{ if(confirm("¿Eliminar todos los registros?")){ save([]); renderList(); } };

    // Mostrar formulario al cargar
    showForm();
    renderList();
  </script>
</body>
</html>
